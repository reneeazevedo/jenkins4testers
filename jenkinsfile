pipeline{
    agent {
        docker {
            image "ruby:alpine"
        }
    }
    stages{
        stage("Build"){
            steps{
                sh "chmod +x build/alpine.sh"
                sh "./build/alpine.sh"
                sh "bundle install"
            }
        }
         stage("Test"){
            steps{
                sh "bundle exec cucumber -p ci"
                
            }
            post{
                always{
                    cucumber failedFeaturesNumber: -1, failedScenariosNumber: -1, failedStepsNumber: -1, fileIncludePattern: '**/*.json', jsonReportDirectory: 'log', pendingStepsNumber: -1, skippedStepsNumber: -1, sortingMethod: 'ALPHABETICAL', undefinedStepsNumber: -1
                    slackSend  channel: "#jenkins",
                        color: 'good',
                        message: "*${currentBuild.currentResult}:* Job ${env.JOB_NAME} build ${env.BUILD_NAME}\n Mais informações acesse: ${env.BUILD_URL}"
                }
            }
        }
        
    }
}